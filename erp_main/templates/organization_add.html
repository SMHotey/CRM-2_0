{% extends 'base.html' %}
{% block content %}

<div class="organization-create-container">
    <div class="organization-create-header">
        <h1 id="form-title" class="organization-create-title">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</h1>
        <p id="form-subtitle" class="organization-create-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</p>
    </div>

    <form method="post" id="organization-form" class="organization-form" novalidate enctype="multipart/form-data">
        {% csrf_token %}

        <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è emails –∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤ -->
        {{ form.emails }}
        {{ form.bank_accounts }}

        {% if form.non_field_errors %}
            <div class="alert alert-error" role="alert">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-content">
                    <strong>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏:</strong>
                    <ul class="alert-list">
                        {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}

        <!-- –¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ -->
        <div class="form-section">
            <div class="section-header">
                <h3 class="section-title">–¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</h3>
            </div>
            <div class="type-selector">
                <label class="type-option">
                    <input type="radio" name="organization_type" value="legal_entity" checked onchange="toggleOrganizationType()">
                    <div class="type-card">
                        <div class="type-icon">üè¢</div>
                        <div class="type-content">
                            <h4>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h4>
                            <p>–û–û–û, –ê–û, –ó–ê–û</p>
                        </div>
                        <div class="type-check"></div>
                    </div>
                </label>
                <label class="type-option">
                    <input type="radio" name="organization_type" value="individual_entrepreneur" onchange="toggleOrganizationType()">
                    <div class="type-card">
                        <div class="type-icon">üìä</div>
                        <div class="type-content">
                            <h4>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</h4>
                            <p>–ò–ü</p>
                        </div>
                        <div class="type-check"></div>
                    </div>
                </label>
                <label class="type-option">
                    <input type="radio" name="organization_type" value="physical_person" onchange="toggleOrganizationType()">
                    <div class="type-card">
                        <div class="type-icon">üë§</div>
                        <div class="type-content">
                            <h4>–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h4>
                            <p>–§–õ</p>
                        </div>
                        <div class="type-check"></div>
                    </div>
                </label>
            </div>
        </div>

        <!-- –ü–æ–ª—è –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ -->
        <div id="legal-entity-fields" class="form-section">
            <div class="section-header">
                <h3 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ</h3>
            </div>
            <div class="form-grid">
                <div class="form-field-group {% if form.kind.errors %}form-field-error{% endif %}">
                    <label for="{{ form.kind.id_for_label }}" class="form-label">
                        –¢–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.kind }}
                    </div>
                    {% for error in form.kind.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.name.errors %}form-field-error{% endif %}">
                    <label for="{{ form.name.id_for_label }}" class="form-label">
                        –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.name }}
                    </div>
                    {% for error in form.name.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.inn.errors %}form-field-error{% endif %}">
                    <label for="{{ form.inn.id_for_label }}" class="form-label">
                        –ò–ù–ù
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.inn }}
                    </div>
                    {% for error in form.inn.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.legal_entity.errors %}form-field-error{% endif %}">
                    <label for="{{ form.legal_entity.id_for_label }}" class="form-label">
                        –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.legal_entity }}
                    </div>
                    {% for error in form.legal_entity.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª—è –¥–ª—è –ò–ü -->
        <div id="individual-entrepreneur-fields" style="display:none;" class="form-section">
            <div class="section-header">
                <h3 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ</h3>
            </div>
            <div class="form-grid">
                <div class="form-field-group {% if form.name_fl.errors %}form-field-error{% endif %}">
                    <label for="{{ form.name_fl.id_for_label }}" class="form-label">
                        –§–ò–û
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.name_fl }}
                    </div>
                    {% for error in form.name_fl.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.inn.errors %}form-field-error{% endif %}">
                    <label for="{{ form.inn.id_for_label }}" class="form-label">
                        –ò–ù–ù
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.inn }}
                    </div>
                    {% for error in form.inn.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.legal_entity.errors %}form-field-error{% endif %}">
                    <label for="{{ form.legal_entity.id_for_label }}" class="form-label">
                        –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.legal_entity }}
                    </div>
                    {% for error in form.legal_entity.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª—è –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ -->
        <div id="physical-person-fields" style="display:none;" class="form-section">
            <div class="section-header">
                <h3 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ</h3>
            </div>
            <div class="form-grid">
                <div class="form-field-group {% if form.name_fl.errors %}form-field-error{% endif %}">
                    <label for="{{ form.name_fl.id_for_label }}" class="form-label">
                        –§–ò–û
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.name_fl }}
                    </div>
                    {% for error in form.name_fl.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group {% if form.phone_number.errors %}form-field-error{% endif %}">
                    <label for="{{ form.phone_number.id_for_label }}" class="form-label">
                        –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="input-wrapper">
                        {{ form.phone_number }}
                    </div>
                    {% for error in form.phone_number.errors %}
                        <div class="field-error-message">
                            <span class="error-icon">‚ùå</span>
                            {{ error }}
                        </div>
                    {% endfor %}
                </div>

                <div class="form-field-group full-width">
                    <label for="{{ form.passport_scan.id_for_label }}" class="form-label">
                        –°–∫–∞–Ω –ø–∞—Å–ø–æ—Ä—Ç–∞
                    </label>
                    <div class="input-wrapper">
                        {{ form.passport_scan }}
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
        <div class="section-actions">
            <button type="button" class="btn btn-outline" onclick="toggleAdditionalFields()" id="additional-fields-btn">
                <span class="btn-icon">üìã</span>
                –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                <span class="btn-arrow">‚ñº</span>
            </button>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è -->
        <div id="additional-fields" style="display:none;" class="form-section additional-section">
            <div class="section-header">
                <h3 class="section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p class="section-description">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
            </div>

            <!-- –û–±—â–∏–µ –ø–æ–ª—è –¥–ª—è —é—Ä–ª–∏—Ü –∏ –ò–ü -->
            <div id="common-additional-fields">
                <!-- Email –∞–¥—Ä–µ—Å–∞ -->
                <div class="form-field-group full-width">
                    <label class="form-label">Email –∞–¥—Ä–µ—Å–∞</label>
                    <div id="email-container">
                        <div class="email-input-group">
                            <input type="email" name="emails[]" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                            <button type="button" class="btn-remove" onclick="removeEmailField(this)">‚úï</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline" onclick="addEmailField()">
                        <span class="btn-icon">‚úâÔ∏è</span>
                        –î–æ–±–∞–≤–∏—Ç—å email
                    </button>
                </div>

                <!-- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã -->
                <div class="form-field-group full-width">
                    <label class="form-label">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</label>
                    <div id="bank-accounts-container">
                        <div class="bank-account-group">
                            <div class="form-grid">
                                <div class="form-field-group">
                                    <label class="form-label">–†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç</label>
                                    <input type="text" name="bank_r_s[]" class="form-input" placeholder="40702810...">
                                </div>
                                <div class="form-field-group">
                                    <label class="form-label">–ë–∞–Ω–∫</label>
                                    <input type="text" name="bank_name[]" class="form-input" placeholder="–ü–ê–û –°–±–µ—Ä–±–∞–Ω–∫">
                                </div>
                                <div class="form-field-group">
                                    <label class="form-label">–ë–ò–ö</label>
                                    <input type="text" name="bank_bik[]" class="form-input" placeholder="044525225">
                                </div>
                                <div class="form-field-group">
                                    <label class="form-label">–ö–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—Å–∫–∏–π —Å—á–µ—Ç</label>
                                    <input type="text" name="bank_k_s[]" class="form-input" placeholder="301018104...">
                                </div>
                            </div>
                            <button type="button" class="btn-remove" onclick="removeBankAccount(this)">–£–¥–∞–ª–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline" onclick="addBankAccount()">
                        <span class="btn-icon">üè¶</span>
                        –î–æ–±–∞–≤–∏—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
                    </button>
                </div>
            </div>

            <!-- –ü–æ–ª—è –¥–ª—è —é—Ä–ª–∏—Ü –∏ –ò–ü (–∫—Ä–æ–º–µ —Ñ–∏–∑–ª–∏—Ü) -->
            <div id="legal-and-ip-fields">
                <!-- –ü–æ–¥–ø–∏—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ -->
                <div class="form-field-group">
                    <label for="id_ceo_footing" class="form-label">–ü–æ–¥–ø–∏—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏</label>
                    <div class="input-wrapper">
                        {{ form.ceo_footing }}
                    </div>
                </div>

                <!-- –î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏) -->
                <div id="attorney-fields" style="display:none;">
                    <div class="form-grid">
                        <div class="form-field-group">
                            <label for="id_attorney_number" class="form-label">–ù–æ–º–µ—Ä –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</label>
                            <div class="input-wrapper">
                                {{ form.attorney_number }}
                            </div>
                        </div>
                        <div class="form-field-group">
                            <label for="id_attorney_date" class="form-label">–î–∞—Ç–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</label>
                            <div class="input-wrapper">
                                {{ form.attorney_date }}
                            </div>
                        </div>
                        <div class="form-field-group full-width">
                            <label for="id_attorney_file" class="form-label">–§–∞–π–ª –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</label>
                            <div class="input-wrapper">
                                {{ form.attorney_file }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û–ì–†–ù/–û–ì–†–ù–ò–ü -->
                <div class="form-grid">
                    <div id="ogrn-field" class="form-field-group">
                        <label for="id_ogrn" class="form-label">–û–ì–†–ù</label>
                        <div class="input-wrapper">
                            {{ form.ogrn }}
                        </div>
                    </div>
                    <div id="ogrnip-field" class="form-field-group" style="display:none;">
                        <label for="id_ogrnip" class="form-label">–û–ì–†–ù–ò–ü</label>
                        <div class="input-wrapper">
                            {{ form.ogrnip }}
                        </div>
                    </div>
                    <div id="kpp-field" class="form-field-group">
                        <label for="id_kpp" class="form-label">–ö–ü–ü</label>
                        <div class="input-wrapper">
                            {{ form.kpp }}
                        </div>
                    </div>
                </div>

                <!-- –ê–¥—Ä–µ—Å–∞ -->
                <div class="form-grid">
                    <div class="form-field-group full-width">
                        <label for="id_address" class="form-label">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <div class="input-wrapper">
                            {{ form.address }}
                        </div>
                    </div>
                    <div id="postal-address-field" class="form-field-group full-width">
                        <label for="id_postal_address" class="form-label">–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å</label>
                        <div class="input-wrapper">
                            {{ form.postal_address }}
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–¥–ø–∏—Å–∞–Ω—Ç -->
                <div class="form-grid">
                    <div class="form-field-group">
                        <label for="id_ceo_title" class="form-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞</label>
                        <div class="input-wrapper">
                            {{ form.ceo_title }}
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label for="id_ceo_name" class="form-label">–§–ò–û –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞</label>
                        <div class="input-wrapper">
                            {{ form.ceo_name }}
                        </div>
                    </div>
                </div>

                <!-- –®–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞ -->
                <div class="form-field-group full-width">
                    <label for="id_contract_template" class="form-label">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞</label>
                    <div class="input-wrapper">
                        {{ form.contract_template }}
                    </div>
                    <div class="help-text" id="auto-template-info"></div>
                </div>

                <div class="form-field-group full-width">
                    <label for="id_custom_contract_template" class="form-label">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–π —à–∞–±–ª–æ–Ω</label>
                    <div class="input-wrapper">
                        {{ form.custom_contract_template }}
                    </div>
                    <div class="help-text">
                        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ .docx.
                        –í —à–∞–±–ª–æ–Ω–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {{organization_name}}, {{inn}} –∏ –¥—Ä—É–≥–∏–µ.
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-submit">
                <span class="btn-text">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</span>
                <span class="btn-loading" style="display: none;">
                    <span class="spinner"></span>
                    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
                </span>
            </button>
        </div>
    </form>
</div>

<style>
.organization-create-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

.organization-create-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.organization-create-title {
    font-size: clamp(1.75rem, 4vw, 2.25rem);
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 0.5rem 0;
}

.organization-create-subtitle {
    font-size: 1rem;
    color: #718096;
    margin: 0;
}

.organization-form {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
}

.form-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e2e8f0;
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
}

.section-header {
    margin-bottom: 1.5rem;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin: 0 0 0.5rem 0;
}

.section-description {
    font-size: 0.875rem;
    color: #718096;
    margin: 0;
}

.type-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

@media (max-width: 1024px) {
    .type-selector {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .type-selector {
        grid-template-columns: 1fr;
    }
}

.type-option {
    cursor: pointer;
}

.type-option input {
    display: none;
}

.type-card {
    position: relative;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    transition: all 0.3s ease;
    background: white;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    min-height: 120px;
    height: 100%;
}

.type-card:hover {
    border-color: #cbd5e0;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.type-option input:checked + .type-card {
    border-color: #4299e1;
    background: #f7fafc;
}

.type-icon {
    font-size: 2rem;
    flex-shrink: 0;
}

.type-content {
    flex: 1;
    min-width: 0;
}

.type-content h4 {
    margin: 0 0 0.25rem 0;
    font-weight: 600;
    color: #2d3748;
    word-wrap: break-word;
}

.type-content p {
    margin: 0;
    font-size: 0.875rem;
    color: #718096;
    word-wrap: break-word;
}

.type-check {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #e2e8f0;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.type-option input:checked + .type-card .type-check {
    border-color: #4299e1;
    background: #4299e1;
}

.type-option input:checked + .type-card .type-check::after {
    content: '‚úì';
    color: white;
    font-size: 0.75rem;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
}

@media (min-width: 768px) {
    .form-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .full-width {
        grid-column: 1 / -1;
    }
}

.form-field-group {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
}

.required-asterisk {
    color: #e53e3e;
}

.input-wrapper {
    position: relative;
}

.form-input, .form-select {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.2s ease;
    background: white;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.form-input:hover, .form-select:hover {
    border-color: #cbd5e0;
}

.form-field-error .form-input,
.form-field-error .form-select {
    border-color: #e53e3e;
}

.form-field-error .form-input:focus,
.form-field-error .form-select:focus {
    border-color: #e53e3e;
    box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
}

.field-error-message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #e53e3e;
    font-size: 0.875rem;
    margin-top: 0.5rem;
}

.error-icon {
    font-size: 0.75rem;
}

.help-text {
    font-size: 0.75rem;
    color: #718096;
    margin-top: 0.25rem;
}

.section-actions {
    margin-top: 1.5rem;
}

.btn-outline {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: white;
    color: #4299e1;
    border: 2px solid #4299e1;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-outline:hover {
    background: #4299e1;
    color: white;
    transform: translateY(-1px);
}

.btn-icon {
    font-size: 1rem;
}

.btn-arrow {
    transition: transform 0.3s ease;
}

.additional-section.active .btn-arrow {
    transform: rotate(180deg);
}

.additional-section {
    background: #f7fafc;
    border-radius: 12px;
    padding: 2rem;
    margin-top: 1rem;
    border: 1px solid #e2e8f0;
}

.form-actions {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e2e8f0;
}

.btn-submit {
    position: relative;
    padding: 0.875rem 2rem;
    background: #4299e1;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 100%;
}

.btn-submit:hover {
    background: #3182ce;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
}

.btn-submit:active {
    transform: translateY(0);
}

.btn-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.spinner {
    width: 1rem;
    height: 1rem;
    border: 2px solid transparent;
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.alert {
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    display: flex;
    gap: 0.75rem;
}

.alert-error {
    background: #fed7d7;
    border: 1px solid #feb2b2;
    color: #c53030;
}

.alert-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
}

.alert-content {
    flex: 1;
}

.alert-list {
    margin: 0.5rem 0 0 0;
    padding-left: 1.25rem;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π */
.email-input-group, .bank-account-group {
    position: relative;
    margin-bottom: 1rem;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
}

.btn-remove {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: #e53e3e;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
}

.btn-remove:hover {
    background: #c53030;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π */
.form-input:read-only {
    background-color: #f7fafc;
    color: #718096;
    cursor: not-allowed;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('organization-form');
    const submitBtn = form.querySelector('.btn-submit');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    const additionalFieldsBtn = document.getElementById('additional-fields-btn');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
    const styleFormFields = () => {
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (!input.classList.contains('form-input') && !input.classList.contains('form-select')) {
                input.classList.add(input.tagName === 'SELECT' ? 'form-select' : 'form-input');
            }
        });
    };

    styleFormFields();

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    loadInitialData();

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
        collectDynamicData();

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        let isValid = validateForm();

        if (!isValid) {
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        btnText.style.display = 'none';
        btnLoading.style.display = 'flex';
        submitBtn.disabled = true;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
        this.submit();
    });

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ
    const inputs = form.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            const fieldGroup = this.closest('.form-field-group');
            if (fieldGroup) {
                fieldGroup.classList.remove('form-field-error');
            }
        });
    });
});

function validateForm() {
    let isValid = true;
    const orgType = document.querySelector('input[name="organization_type"]:checked').value;

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
    document.querySelectorAll('.form-field-error').forEach(el => {
        el.classList.remove('form-field-error');
    });

    if (orgType === 'legal_entity') {
        const kindField = document.querySelector('select[name="kind"]');
        const nameField = document.querySelector('input[name="name"]');
        const innField = document.querySelector('input[name="inn"]');
        const legalEntityField = document.querySelector('select[name="legal_entity"]');

        if (!kindField.value) {
            isValid = false;
            kindField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!nameField.value.trim()) {
            isValid = false;
            nameField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!innField.value.trim()) {
            isValid = false;
            innField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!legalEntityField.value) {
            isValid = false;
            legalEntityField.closest('.form-field-group').classList.add('form-field-error');
        }
    } else if (orgType === 'individual_entrepreneur') {
        const nameFlField = document.querySelector('input[name="name_fl"]');
        const innField = document.querySelector('input[name="inn"]');
        const legalEntityField = document.querySelector('select[name="legal_entity"]');

        if (!nameFlField.value.trim()) {
            isValid = false;
            nameFlField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!innField.value.trim()) {
            isValid = false;
            innField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!legalEntityField.value) {
            isValid = false;
            legalEntityField.closest('.form-field-group').classList.add('form-field-error');
        }
    } else if (orgType === 'physical_person') {
        const nameFlField = document.querySelector('input[name="name_fl"]');
        const phoneNumberField = document.querySelector('input[name="phone_number"]');

        if (!nameFlField.value.trim()) {
            isValid = false;
            nameFlField.closest('.form-field-group').classList.add('form-field-error');
        }
        if (!phoneNumberField.value.trim()) {
            isValid = false;
            phoneNumberField.closest('.form-field-group').classList.add('form-field-error');
        }
    }

    return isValid;
}

function loadInitialData() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö emails
    const emailsField = document.getElementById('id_emails');
    if (emailsField && emailsField.value) {
        const emails = emailsField.value.split(',');
        const emailContainer = document.getElementById('email-container');
        emailContainer.innerHTML = '';

        emails.forEach(email => {
            if (email.trim()) {
                addEmailField(email.trim());
            }
        });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤
    const bankAccountsField = document.getElementById('id_bank_accounts');
    if (bankAccountsField && bankAccountsField.value) {
        try {
            const bankAccounts = JSON.parse(bankAccountsField.value);
            const bankContainer = document.getElementById('bank-accounts-container');
            bankContainer.innerHTML = '';

            bankAccounts.forEach(account => {
                addBankAccount(account);
            });
        } catch (e) {
            console.error('Error parsing bank accounts:', e);
        }
    }
}

function collectDynamicData() {
    // –°–æ–±–∏—Ä–∞–µ–º emails
    const emailInputs = document.querySelectorAll('input[name="emails[]"]');
    const emails = Array.from(emailInputs)
        .map(input => input.value.trim())
        .filter(email => email);

    document.getElementById('id_emails').value = emails.join(',');

    // –°–æ–±–∏—Ä–∞–µ–º –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞
    const bankAccounts = [];
    document.querySelectorAll('.bank-account-group').forEach(group => {
        const r_s = group.querySelector('input[name="bank_r_s[]"]').value.trim();
        const bank = group.querySelector('input[name="bank_name[]"]').value.trim();
        const bik = group.querySelector('input[name="bank_bik[]"]').value.trim();
        const k_s = group.querySelector('input[name="bank_k_s[]"]').value.trim();

        if (r_s || bank) {
            bankAccounts.push({
                r_s: r_s,
                bank: bank,
                bik: bik,
                k_s: k_s
            });
        }
    });

    document.getElementById('id_bank_accounts').value = JSON.stringify(bankAccounts);
}

function toggleOrganizationType() {
    const orgType = document.querySelector('input[name="organization_type"]:checked').value;

    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
    document.getElementById('legal-entity-fields').style.display = 'none';
    document.getElementById('individual-entrepreneur-fields').style.display = 'none';
    document.getElementById('physical-person-fields').style.display = 'none';

    // –°–∫—Ä—ã–≤–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    document.getElementById('additional-fields').style.display = 'none';
    document.getElementById('additional-fields-btn').innerHTML = '<span class="btn-icon">üìã</span>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è<span class="btn-arrow">‚ñº</span>';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    if (orgType === 'legal_entity') {
        document.getElementById('legal-entity-fields').style.display = 'block';
        document.getElementById('common-additional-fields').style.display = 'block';
        document.getElementById('legal-and-ip-fields').style.display = 'block';
        document.getElementById('ogrn-field').style.display = 'block';
        document.getElementById('ogrnip-field').style.display = 'none';
        document.getElementById('kpp-field').style.display = 'block';
        document.getElementById('postal-address-field').style.display = 'block';

        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ –ø–æ—á—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞
        const postalAddressField = document.getElementById('id_postal_address');
        if (postalAddressField) {
            postalAddressField.readOnly = false;
            postalAddressField.style.backgroundColor = 'white';
        }
    } else if (orgType === 'individual_entrepreneur') {
        document.getElementById('individual-entrepreneur-fields').style.display = 'block';
        document.getElementById('common-additional-fields').style.display = 'block';
        document.getElementById('legal-and-ip-fields').style.display = 'block';
        document.getElementById('ogrn-field').style.display = 'none';
        document.getElementById('ogrnip-field').style.display = 'block';
        document.getElementById('kpp-field').style.display = 'none';
        document.getElementById('postal-address-field').style.display = 'block';

        // –î–ª—è –ò–ü –ø–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å –≤—Å–µ–≥–¥–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º
        syncAddresses();
    } else if (orgType === 'physical_person') {
        document.getElementById('physical-person-fields').style.display = 'block';
        document.getElementById('common-additional-fields').style.display = 'none';
        document.getElementById('legal-and-ip-fields').style.display = 'none';
    }

    updateFormTitle(orgType);
}

function syncAddresses() {
    const addressField = document.getElementById('id_address');
    const postalAddressField = document.getElementById('id_postal_address');

    if (addressField && postalAddressField) {
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
        postalAddressField.value = addressField.value;

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ –ø–æ—á—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –ò–ü
        postalAddressField.readOnly = true;
        postalAddressField.style.backgroundColor = '#f7fafc';

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –∞–¥—Ä–µ—Å–∞
        addressField.addEventListener('input', function() {
            postalAddressField.value = this.value;
        });
    }
}

function updateFormTitle(orgType) {
    const formTitle = document.getElementById('form-title');
    const formSubtitle = document.getElementById('form-subtitle');

    if (orgType === 'legal_entity') {
        formTitle.innerText = '–î–æ–±–∞–≤–∏—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ';
        formSubtitle.innerText = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ';
    } else if (orgType === 'individual_entrepreneur') {
        formTitle.innerText = '–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è';
        formSubtitle.innerText = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ';
    } else if (orgType === 'physical_person') {
        formTitle.innerText = '–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ';
        formSubtitle.innerText = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ';
    }
}

function toggleAdditionalFields() {
    const additionalFields = document.getElementById('additional-fields');
    const additionalBtn = document.getElementById('additional-fields-btn');
    const arrow = additionalBtn.querySelector('.btn-arrow');

    if (additionalFields.style.display === 'none') {
        additionalFields.style.display = 'block';
        additionalFields.classList.add('active');
        arrow.style.transform = 'rotate(180deg)';
        additionalBtn.innerHTML = '<span class="btn-icon">üìã</span>–°–∫—Ä—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é<span class="btn-arrow">‚ñº</span>';
    } else {
        additionalFields.style.display = 'none';
        additionalFields.classList.remove('active');
        arrow.style.transform = 'rotate(0deg)';
        additionalBtn.innerHTML = '<span class="btn-icon">üìã</span>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è<span class="btn-arrow">‚ñº</span>';
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å email –ø–æ–ª—è–º–∏
function addEmailField(value = '') {
    const container = document.getElementById('email-container');
    const newEmailGroup = document.createElement('div');
    newEmailGroup.className = 'email-input-group';
    newEmailGroup.innerHTML = `
        <input type="email" name="emails[]" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ email" value="${value}">
        <button type="button" class="btn-remove" onclick="removeEmailField(this)">‚úï</button>
    `;
    container.appendChild(newEmailGroup);
}

function removeEmailField(button) {
    const container = document.getElementById('email-container');
    if (container.children.length > 1) {
        button.parentElement.remove();
    } else {
        // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ª–µ, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –µ–≥–æ
        button.parentElement.querySelector('input').value = '';
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ —Å—á–µ—Ç–∞–º–∏
function addBankAccount(accountData = {}) {
    const container = document.getElementById('bank-accounts-container');
    const newAccount = document.createElement('div');
    newAccount.className = 'bank-account-group';
    newAccount.innerHTML = `
        <div class="form-grid">
            <div class="form-field-group">
                <label class="form-label">–†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç</label>
                <input type="text" name="bank_r_s[]" class="form-input" placeholder="40702810..." value="${accountData.r_s || ''}">
            </div>
            <div class="form-field-group">
                <label class="form-label">–ë–∞–Ω–∫</label>
                <input type="text" name="bank_name[]" class="form-input" placeholder="–ü–ê–û –°–±–µ—Ä–±–∞–Ω–∫" value="${accountData.bank || ''}">
            </div>
            <div class="form-field-group">
                <label class="form-label">–ë–ò–ö</label>
                <input type="text" name="bank_bik[]" class="form-input" placeholder="044525225" value="${accountData.bik || ''}">
            </div>
            <div class="form-field-group">
                <label class="form-label">–ö–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—Å–∫–∏–π —Å—á–µ—Ç</label>
                <input type="text" name="bank_k_s[]" class="form-input" placeholder="301018104..." value="${accountData.k_s || ''}">
            </div>
        </div>
        <button type="button" class="btn-remove" onclick="removeBankAccount(this)">–£–¥–∞–ª–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</button>
    `;
    container.appendChild(newAccount);
}

function removeBankAccount(button) {
    const container = document.getElementById('bank-accounts-container');
    if (container.children.length > 1) {
        button.parentElement.remove();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞ –¥–æ–≥–æ–≤–æ—Ä–∞
function updateContractTemplate() {
    const orgType = document.querySelector('input[name="organization_type"]:checked').value;
    const legalEntity = document.getElementById('id_legal_entity').value;
    const kind = document.getElementById('id_kind').value;
    const footing = document.getElementById('id_ceo_footing').value;

    if (orgType === 'physical_person') return;

    const params = new URLSearchParams({
        'organization_type': orgType,
        'legal_entity': legalEntity,
        'kind': kind,
        'ceo_footing': footing
    });

    fetch(`/api/get-contract-template/?${params}`)
        .then(response => response.json())
        .then(data => {
            const templateSelect = document.getElementById('id_contract_template');
            const infoElement = document.getElementById('auto-template-info');

            if (data.template_id && templateSelect) {
                templateSelect.value = data.template_id;
                infoElement.textContent = `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω: ${data.template_name}`;
                infoElement.style.color = '#38a169';
            } else {
                infoElement.textContent = '–ü–æ–¥—Ö–æ–¥—è—â–∏–π —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω';
                infoElement.style.color = '#e53e3e';
            }
        })
        .catch(error => {
            console.error('Error fetching contract template:', error);
        });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞
document.addEventListener('DOMContentLoaded', function() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –¥–æ–≥–æ–≤–æ—Ä–∞
    const legalEntityField = document.getElementById('id_legal_entity');
    const kindField = document.getElementById('id_kind');
    const footingField = document.getElementById('id_ceo_footing');

    if (legalEntityField) {
        legalEntityField.addEventListener('change', updateContractTemplate);
    }
    if (kindField) {
        kindField.addEventListener('change', updateContractTemplate);
    }
    if (footingField) {
        footingField.addEventListener('change', function() {
            updateContractTemplate();
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            const attorneyFields = document.getElementById('attorney-fields');
            if (attorneyFields) {
                attorneyFields.style.display = this.value === 'attorney' ? 'block' : 'none';
            }
        });
    }

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –ò–ü
    const addressField = document.getElementById('id_address');
    if (addressField) {
        addressField.addEventListener('input', function() {
            const orgType = document.querySelector('input[name="organization_type"]:checked').value;
            if (orgType === 'individual_entrepreneur') {
                syncAddresses();
            }
        });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    toggleOrganizationType();
});
</script>
{% endblock %}