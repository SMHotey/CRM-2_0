{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Выставленные счета</h2>

    <!-- Форма поиска и фильтрации -->
    <form method="GET" action="{% url 'invoices_list' %}" class="form-inline mb-3">
        <label>
            <input type="text" name="search" class="form-control mr-2" placeholder="Поиск по номеру или организации" value="{{ request.GET.search }}">
        </label>

        <label>
            <select name="legal_entity" class="form-control mr-2">
                <option value="">Все юридические лица</option>
                {% for l_e in legal_entities %}
                    <option value="{{ l_e.id }}" {% if l_e.id == selected_legal_entity_id %}selected{% endif %}>{{ l_e.name }}</option>
                {% endfor %}
            </select>
        </label>

        <button type="submit" class="btn btn-primary">Применить</button>
    </form>

    <!-- Таблица с инвойсами -->
    <table class="table table-bordered">
        <thead>
            <tr>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Номер</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Организация</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Дата</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Сумма</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Оплачено</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Доставка</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Монтаж</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Менеджер</th>
                <th style="padding: 8px; text-align: center; vertical-align: middle;">Юридическое лицо</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices %}
            <tr>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">
                    <a href="{% url 'invoice_detail' invoice.id %}">{{ invoice.number }}</a></td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.organization.name }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.date }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.amount }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.payed_amount }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.shipping_amount }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.montage_amount }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.organization.user.get_full_name }}</td>
                <td style="padding: 8px; text-align: center; vertical-align: middle;">{{ invoice.legal_entity }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="text-center">Нет данных для отображения</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Пагинация -->
    <div class="pagination">
        {% if invoices.has_previous %}
            <a href="?page=1">&laquo; Первая</a>
            <a href="?page={{ invoices.previous_page_number }}">Предыдущая</a>
        {% endif %}

        <span>Страница {{ invoices.number }} из {{ invoices.paginator.num_pages }}</span>

        {% if invoices.has_next %}
            <a href="?page={{ invoices.next_page_number }}">Следующая</a>
            <a href="?page={{ invoices.paginator.num_pages }}">Последняя &raquo;</a>
        {% endif %}
    </div>
</div>
{% endblock %}